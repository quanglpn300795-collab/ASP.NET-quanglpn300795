{"version":3,"sources":["../../src/vertexai/index.ts"],"sourcesContent":["/**\n * @license\n *\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @module /\n */\n\nimport { EmbedderReference, Genkit, ModelReference, z } from 'genkit';\nimport { GenkitPlugin, genkitPlugin } from 'genkit/plugin';\nimport { ActionType } from 'genkit/registry';\nimport { listModels } from './client.js';\n\nimport * as embedder from './embedder.js';\nimport * as gemini from './gemini.js';\nimport * as imagen from './imagen.js';\nimport * as lyria from './lyria.js';\nimport * as veo from './veo.js';\n\nimport { VertexPluginOptions } from './types.js';\nimport { getDerivedOptions } from './utils.js';\n\nexport { type EmbeddingConfig } from './embedder.js';\nexport { type GeminiConfig } from './gemini.js';\nexport { type ImagenConfig } from './imagen.js';\nexport { type LyriaConfig } from './lyria.js';\nexport { type VertexPluginOptions } from './types.js';\nexport { type VeoConfig } from './veo.js';\n\nasync function initializer(ai: Genkit, pluginOptions?: VertexPluginOptions) {\n  const clientOptions = await getDerivedOptions(pluginOptions);\n  veo.defineKnownModels(ai, clientOptions, pluginOptions);\n  imagen.defineKnownModels(ai, clientOptions, pluginOptions);\n  lyria.defineKnownModels(ai, clientOptions, pluginOptions);\n  gemini.defineKnownModels(ai, clientOptions, pluginOptions);\n  embedder.defineKnownModels(ai, clientOptions, pluginOptions);\n}\n\nasync function resolver(\n  ai: Genkit,\n  actionType: ActionType,\n  actionName: string,\n  pluginOptions?: VertexPluginOptions\n) {\n  const clientOptions = await getDerivedOptions(pluginOptions);\n  switch (actionType) {\n    case 'model':\n      if (lyria.isLyriaModelName(actionName)) {\n        lyria.defineModel(ai, actionName, clientOptions, pluginOptions);\n      } else if (imagen.isImagenModelName(actionName)) {\n        imagen.defineModel(ai, actionName, clientOptions, pluginOptions);\n      } else if (veo.isVeoModelName(actionName)) {\n        // no-op (not gemini)\n      } else {\n        gemini.defineModel(ai, actionName, clientOptions, pluginOptions);\n      }\n      break;\n    case 'background-model':\n      if (veo.isVeoModelName(actionName)) {\n        veo.defineModel(ai, actionName, clientOptions, pluginOptions);\n      }\n      break;\n    case 'embedder':\n      embedder.defineEmbedder(ai, actionName, clientOptions, pluginOptions);\n      break;\n    default:\n    // no-op\n  }\n}\n\nasync function listActions(options?: VertexPluginOptions) {\n  try {\n    const clientOptions = await getDerivedOptions(options);\n    const models = await listModels(clientOptions);\n    return [\n      ...gemini.listActions(models),\n      ...imagen.listActions(models),\n      ...lyria.listActions(models),\n      ...veo.listActions(models),\n      // We don't list embedders here\n    ];\n  } catch (e: unknown) {\n    // Errors are already logged in the client code.\n    return [];\n  }\n}\n\n/**\n * Add Google Cloud Vertex AI to Genkit. Includes Gemini and Imagen models and text embedder.\n */\nfunction vertexAIPlugin(options?: VertexPluginOptions): GenkitPlugin {\n  let listActionsCache;\n  return genkitPlugin(\n    'vertexai',\n    async (ai: Genkit) => await initializer(ai, options),\n    async (ai: Genkit, actionType: ActionType, actionName: string) =>\n      await resolver(ai, actionType, actionName, options),\n    async () => {\n      if (listActionsCache) return listActionsCache;\n      listActionsCache = await listActions(options);\n      return listActionsCache;\n    }\n  );\n}\n\nexport type VertexAIPlugin = {\n  (pluginOptions?: VertexPluginOptions): GenkitPlugin;\n  model(\n    name: gemini.KnownModels | (gemini.GeminiModelName & {}),\n    config?: gemini.GeminiConfig\n  ): ModelReference<gemini.GeminiConfigSchemaType>;\n  model(\n    name: imagen.KnownModels | (imagen.ImagenModelName & {}),\n    config?: imagen.ImagenConfig\n  ): ModelReference<imagen.ImagenConfigSchemaType>;\n  model(\n    name: lyria.KnownModels | (lyria.LyriaModelName & {}),\n    config: lyria.LyriaConfig\n  ): ModelReference<lyria.LyriaConfigSchemaType>;\n  model(\n    name: veo.KnownModels | (veo.VeoModelName & {}),\n    config: veo.VeoConfig\n  ): ModelReference<veo.VeoConfigSchemaType>;\n  model(name: string, config?: any): ModelReference<z.ZodTypeAny>;\n\n  embedder(\n    name: string,\n    config?: embedder.EmbeddingConfig\n  ): EmbedderReference<embedder.EmbeddingConfigSchemaType>;\n};\n\n/**\n * Google Cloud Vertex AI plugin for Genkit.\n * Includes Gemini and Imagen models and text embedder.\n */\nexport const vertexAI = vertexAIPlugin as VertexAIPlugin;\n// provide generic implementation for the model function overloads.\n(vertexAI as any).model = (\n  name: string,\n  config?: any\n): ModelReference<z.ZodTypeAny> => {\n  if (imagen.isImagenModelName(name)) {\n    return imagen.model(name, config);\n  }\n  if (lyria.isLyriaModelName(name)) {\n    return lyria.model(name, config);\n  }\n  if (veo.isVeoModelName(name)) {\n    return veo.model(name, config);\n  }\n  // gemini and unknown model families\n  return gemini.model(name, config);\n};\nvertexAI.embedder = (\n  name: string,\n  config?: embedder.EmbeddingConfig\n): EmbedderReference<embedder.EmbeddingConfigSchemaType> => {\n  return embedder.model(name, config);\n};\n\nexport default vertexAI;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAuBA,oBAA2C;AAE3C,oBAA2B;AAE3B,eAA0B;AAC1B,aAAwB;AACxB,aAAwB;AACxB,YAAuB;AACvB,UAAqB;AAGrB,mBAAkC;AAlClC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA2CA,eAAe,YAAY,IAAY,eAAqC;AAC1E,QAAM,gBAAgB,UAAM,gCAAkB,aAAa;AAC3D,MAAI,kBAAkB,IAAI,eAAe,aAAa;AACtD,SAAO,kBAAkB,IAAI,eAAe,aAAa;AACzD,QAAM,kBAAkB,IAAI,eAAe,aAAa;AACxD,SAAO,kBAAkB,IAAI,eAAe,aAAa;AACzD,WAAS,kBAAkB,IAAI,eAAe,aAAa;AAC7D;AAEA,eAAe,SACb,IACA,YACA,YACA,eACA;AACA,QAAM,gBAAgB,UAAM,gCAAkB,aAAa;AAC3D,UAAQ,YAAY;AAAA,IAClB,KAAK;AACH,UAAI,MAAM,iBAAiB,UAAU,GAAG;AACtC,cAAM,YAAY,IAAI,YAAY,eAAe,aAAa;AAAA,MAChE,WAAW,OAAO,kBAAkB,UAAU,GAAG;AAC/C,eAAO,YAAY,IAAI,YAAY,eAAe,aAAa;AAAA,MACjE,WAAW,IAAI,eAAe,UAAU,GAAG;AAAA,MAE3C,OAAO;AACL,eAAO,YAAY,IAAI,YAAY,eAAe,aAAa;AAAA,MACjE;AACA;AAAA,IACF,KAAK;AACH,UAAI,IAAI,eAAe,UAAU,GAAG;AAClC,YAAI,YAAY,IAAI,YAAY,eAAe,aAAa;AAAA,MAC9D;AACA;AAAA,IACF,KAAK;AACH,eAAS,eAAe,IAAI,YAAY,eAAe,aAAa;AACpE;AAAA,IACF;AAAA,EAEF;AACF;AAEA,eAAe,YAAY,SAA+B;AACxD,MAAI;AACF,UAAM,gBAAgB,UAAM,gCAAkB,OAAO;AACrD,UAAM,SAAS,UAAM,0BAAW,aAAa;AAC7C,WAAO;AAAA,MACL,GAAG,OAAO,YAAY,MAAM;AAAA,MAC5B,GAAG,OAAO,YAAY,MAAM;AAAA,MAC5B,GAAG,MAAM,YAAY,MAAM;AAAA,MAC3B,GAAG,IAAI,YAAY,MAAM;AAAA;AAAA,IAE3B;AAAA,EACF,SAAS,GAAY;AAEnB,WAAO,CAAC;AAAA,EACV;AACF;AAKA,SAAS,eAAe,SAA6C;AACnE,MAAI;AACJ,aAAO;AAAA,IACL;AAAA,IACA,OAAO,OAAe,MAAM,YAAY,IAAI,OAAO;AAAA,IACnD,OAAO,IAAY,YAAwB,eACzC,MAAM,SAAS,IAAI,YAAY,YAAY,OAAO;AAAA,IACpD,YAAY;AACV,UAAI,iBAAkB,QAAO;AAC7B,yBAAmB,MAAM,YAAY,OAAO;AAC5C,aAAO;AAAA,IACT;AAAA,EACF;AACF;AAgCO,MAAM,WAAW;AAEvB,SAAiB,QAAQ,CACxB,MACA,WACiC;AACjC,MAAI,OAAO,kBAAkB,IAAI,GAAG;AAClC,WAAO,OAAO,MAAM,MAAM,MAAM;AAAA,EAClC;AACA,MAAI,MAAM,iBAAiB,IAAI,GAAG;AAChC,WAAO,MAAM,MAAM,MAAM,MAAM;AAAA,EACjC;AACA,MAAI,IAAI,eAAe,IAAI,GAAG;AAC5B,WAAO,IAAI,MAAM,MAAM,MAAM;AAAA,EAC/B;AAEA,SAAO,OAAO,MAAM,MAAM,MAAM;AAClC;AACA,SAAS,WAAW,CAClB,MACA,WAC0D;AAC1D,SAAO,SAAS,MAAM,MAAM,MAAM;AACpC;AAEA,IAAO,mBAAQ;","names":[]}